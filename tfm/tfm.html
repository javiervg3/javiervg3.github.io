<html lang="es">
<head>
	<title>visor d'inventaris PNSC</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="author" content="autor"/>
	<meta name="description" content="descripción página">
	<meta name="robots" content="index,follow">
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
	<link rel="stylesheet" href="css/leaflet-search.min.css" />
	
	<style>
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
		}
		
		#map {
			height: 100%;
			width: 75%;
			background-color: #ffffff
		}
			
	</style>
	
	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
	<script src="js/leaflet.ajax.min.js"></script>
	<script src="js/leaflet-search.min.js"></script>
	
	<script>
			var map;
			var osm;
			var esri;
			var capaGeoJson
			var controlCapas;
		
		function init(){
		
			map = L.map('map', {
					center: [41.434974, 2.091355],
					zoom: 13
			});
			
			esri = L.tileLayer(
				'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
				{
					maxZoom : 19,
					minZoom : 12,
					attribution : 'Tiles © Esri',

				}).addTo(map);

				
			osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
				{
					maxZoom: 19,
					minZoom: 12,
					attribution: 'OSM'
				});
							
						
			var capaGeoJson=L.geoJson.ajax('../datos/cataleg_construccions.geojson', {

				style: function (feature) {
					var _color={color:'#ffffff',weight:1,fillOpacity:0.5,fillColor:'#DD0000'};
							
								
					return _color;
				},

					onEachFeature: function(feature, layer) {
							popupContent =
							"<br>CODI: "+feature.properties.ID_MASIA+"</br>"
							;
							layer.bindPopup(popupContent);
					}
				}).addTo(map);
				
			var searchControl = new L.Control.Search({
					layer: capaGeoJson,
					propertyName: 'ID_MASIA',
					circleLocation: true
				});

				searchControl.on('search_locationfound', function(feature) {
					feature.layer.setStyle({
						fillColor: '#ff0000',
						weight: 2,
						opacity: 1,
					});

				}).on('search_collapsed', function() {
					  capaGeoJson.eachLayer(function(layer) {
							capaGeoJson.resetStyle(layer);
					});
				});
				
				map.addControl(searchControl);
				
			var baseMaps = {
				"Orto_esri": esri,
				"Mapa_osm": osm
			};

			var overlayMaps = {
				"construccions": capaGeoJson
			};
			
			controlCapas=L.control.layers(baseMaps, overlayMaps, {collapsed:false});
			controlCapas.addTo(map);
			controlEscala=L.control.scale();
			controlEscala.addTo(map);
				
		}

	</script>
</head>
<body onLoad="init()">
	<div id="map"></div>
	<div id="titulo">catàleg de construccions</div>
</body>
</html>
