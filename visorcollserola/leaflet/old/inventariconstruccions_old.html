<html lang="es">

<head>
	<title>Catàleg de Construccions</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="author" content="autor" />
	<meta name="description" content="descripción página">
	<meta name="robots" content="index,follow">
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
	<link rel="stylesheet" href="css/leaflet-search.min.css" />

	<style>
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
		}

		#map {
			height: 100%;
			width: 100%;
			background-color: #ffffff
		}

		#cercacodi{
			position: absolute;
			top:5px;
			left:40%
			z-index:1;
			background-color: #ffffff;
			color: #000000;
			padding:2px 28px 2px 6px;
			opacity:0.9;
			border-radius:3px;
			font-family: calibri;
			font-size:18px;
			left:50px;
			top:74px;
		}

		#cercanom{
			position: absolute;
			top:5px;
			left:40%
			z-index:1;
			background-color: #ffffff;
			color: #000000;
			padding:2px 24px 2px 6px;
			opacity:0.9;
			border-radius:3px;
			font-family: calibri;
			font-size:18px;
			left:50px;
			top:110px;
		}

		#fitxa {
			top: 10px;
			bottom: 10px;
			position: absolute;
			right: 10px;
			width: 300px;
			background-color: rgb(255, 255, 255);
			z-index: 1000;
			height: 94%;
			padding: 10px;
			border-radius: 6px;
			opacity: 0.85;

		}

	</style>

	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
	<script src="js/leaflet.ajax.min.js"></script>
	<script src="js/leaflet-search.min.js"></script>

	<script>
		var map;
		var ortoICGC;
		var mapaICGC;
		var mascaraPNSC;
		var limitPNSC;
		var limitMuni;
		var catalegConstruccions;
		var unitatsFinca;
		var controlCapas;

		function init() {

			map = L.map('map', {
				center: [41.434974, 2.091355],
				zoom: 13
			});

			ortoICGC = L.tileLayer(
				'https://geoserveis.icgc.cat/icc_mapesmultibase/noutm/wmts/orto/GRID3857/{z}/{x}/{y}.jpeg', {
					maxZoom: 19,
					minZoom: 13,
					attribution: 'Orto ICGC',

			}).addTo(map);


			mapaICGC = L.tileLayer(
				'https://geoserveis.icgc.cat/icc_mapesmultibase/noutm/wmts/topo/GRID3857/{z}/{x}/{y}.jpeg', {
				maxZoom: 19,
				minZoom: 13,
				attribution: 'Mapa ICGC'
			});

			var mascaraPNSC = L.geoJson.ajax('../datos/mascaraPNSC_4326.geojson', {

				style: function(feature) {
					var _color = {
						color: '#ffffff',
						weight: 0,
						fillOpacity: 0.3,
						fillColor: '#ffffff'
					};

					return _color;
				},

			}).addTo(map);

			var limitPNSC = L.geoJson.ajax('../datos/limitPNSC_4326.geojson', {

				style: function(feature) {
					var _color = {
						color: '#009600',
						weight: 4,
						fillOpacity: 1,
					};

					return _color;
				},
				
			}).addTo(map);


			var limitMuni = L.geoJson.ajax('../datos/limitMuni_4326.geojson', {

				style: function(feature) {
					var _color = {
						color: '#ffff64',
						weight: 3,
						fillOpacity: 1,
					};

					return _color;
				},

			}).addTo(map);

			var unitatsFinca = L.geoJson.ajax('../datos/unitatsFinca_4326.geojson', {

				style: function(feature) {
					var _color = {
						color: '#ffffff',
						weight: 1,
						fillOpacity: 0.3,
						fillColor: '#ffbf6c'
					};
					return _color;
				},

				onEachFeature: function(feature, layer) {
					popupContent =
					"<img src='.../fotos/" + feature.properties.ID_FOTO +".jpg'>"+
					"<br> " + feature.properties.ID_CONSTRU + " " + feature.properties.NOMFINCA +  "</br>" +
					"<br>SUPERFÍCIE: " + feature.properties.SAREA + "</br>" 
					;
					layer.bindPopup(popupContent);
				}
			});

			var catalegConstruccions = L.geoJson.ajax('../datos/cataleg_construccions_4326.geojson', {

				style: function(feature) {
					var _color = {
						color: '#ffffff',
						weight: 2,
						fillOpacity: 0.8,
						fillColor: '#DD0000'
					};

					return _color;
				},

				onEachFeature: function(feature, layer) {
					popupContent =
					"<img src='.../fotos/" + feature.properties.ID_FOTO +".jpg'>"+
					"<br> " + feature.properties.ID_MASIA + " " + feature.properties.LOC_NOM +  "</br>" +
					"<br>ADREÇA: " + feature.properties.LOC_ADR + "</br>" +
					"<br>MUNICIPI: " + feature.properties.LOC_CODIIN + " " +feature.properties.LOC_MUN + "</br>" +
					"<br>TIPOLOGIA: " + feature.properties.TIP_TIP + "</br>" +
					"<br>REF. CADASTRAL: " + feature.properties.DAD_REFCAD + "</br>" +
					"<br>SOSTRE: " + feature.properties.DAD_REFC_1 + "m2</br>" +
					"<br>TITULARITAT: " + feature.properties.DAD_REFC_2 + "</br>" +
					"<br>CAMÍ D'ACCÉS: " + feature.properties.ACCES_CODI + "</br>" +
					"<br>" + feature.properties.DADES_VOL + "</br>"
					;
					layer.bindPopup(popupContent);
				}

			}).addTo(map);

			
			var searchControlCodi = new L.Control.Search({
				layer: catalegConstruccions,
				propertyName: 'ID_MASIA',
				circleLocation: true
			});

			searchControlCodi.on('search_locationfound', function(feature) {
				feature.layer.setStyle({
					fillColor: '#ff0000',
					weight: 10,
					opacity: 1,
				});

			}).on('search_collapsed', function() {
				catalegConstruccions.eachLayer(function(layer) {
				catalegConstruccions.resetStyle(layer);
				});
			});

			map.addControl(searchControlCodi);

			var searchControlNom = new L.Control.Search({
				layer: catalegConstruccions,
				propertyName: 'LOC_NOM',
				circleLocation: true
			});

			searchControlNom.on('search_locationfound', function(feature) {
				feature.layer.setStyle({
					fillColor: '#ff0000',
					weight: 2,
					opacity: 1,
				});

			}).on('search_collapsed', function() {
				catalegConstruccions.eachLayer(function(layer) {
				catalegConstruccions.resetStyle(layer);
				});
			});

			map.addControl(searchControlNom);


			var baseMaps = {
				"Ortofoto ICGC": ortoICGC,
				"Mapa Topogràfic ICGC": mapaICGC
			};

			var overlayMaps = {
				"Delimitació del PNSC": limitPNSC,
				"Delimitació municipal": limitMuni,
				"Catàleg de Construccions": catalegConstruccions,
				"Unitats de Finca": unitatsFinca,
			};

			controlCapas = L.control.layers(baseMaps, overlayMaps, {
				collapsed: false,
				position: 'topleft'

			});

			controlCapas.addTo(map);

			controlEscala = L.control.scale({
				position: 'bottomleft'

			});

			controlEscala.addTo(map);



			function escriu(e) {

			console.info(e.target.feature.properties);
			var txt = "<b>Contruccions</b>" +

				"<p>" + e.target.feature.properties.ID_MASIA + "</p>";
				
			document.getElementById('titulo').innerHTML=txt;

			};

				}
	</script>
</head>

<body onLoad="init()">
	<div id="map"></div>
	<div id="cercacodi">cerca per codi</div>
	<div id="cercanom">cerca per nom</div>
	<div id="fitxa"></div>
</body>

</html>
